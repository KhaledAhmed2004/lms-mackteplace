{
  "info": {
    "name": "Applications API Collection",
    "description": "Auto-generated collection for Applications module",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Submit tutor application (PUBLIC - creates user + application)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/v1/applications",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "v1",
            "applications"
          ]
        },
        "auth": {
          "type": "noauth"
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{TEST_EMAIL}}\",\n  \"password\": \"{{TEST_PASSWORD}}\",\n  \"name\": \"{{TEST_NAME}}\",\n  \"birthDate\": \"1995-05-15\",\n  \"phone\": \"+49123456789\",\n  \"street\": \"Hauptstraße\",\n  \"houseNumber\": \"42\",\n  \"zipCode\": \"10115\",\n  \"city\": \"Berlin\",\n  \"subjects\": [\n    \"{{subjectId}}\"\n  ],\n  \"cv\": \"https://example.com/cv.pdf\",\n  \"abiturCertificate\": \"https://example.com/abitur.pdf\",\n  \"officialIdDocument\": \"https://example.com/id.pdf\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Auto-save applicationId",
              "const response = pm.response.json();",
              "",
              "if (response.success && response.data && response.data._id) {",
              "  pm.collectionVariables.set(\"applicationId\", response.data._id);",
              "  console.log(\"✅ applicationId saved:\", response.data._id);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Get my application status",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/v1/applications/my-application",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "v1",
            "applications",
            "my-application"
          ]
        },
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get all applications with filtering, searching, pagination",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/v1/applications",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "v1",
            "applications"
          ]
        },
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get single application by ID",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/v1/applications/{{id}}",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "v1",
            "applications",
            "{{id}}"
          ]
        },
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Approve application (changes user role to TUTOR)",
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/v1/applications/{{id}}/approve",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "v1",
            "applications",
            "{{id}}",
            "approve"
          ]
        },
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"adminNotes\": \"Admin notes here\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        }
      },
      "response": []
    },
    {
      "name": "Reject application",
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/v1/applications/{{id}}/reject",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "v1",
            "applications",
            "{{id}}",
            "reject"
          ]
        },
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"rejectionReason\": \"Application does not meet requirements\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        }
      },
      "response": []
    },
    {
      "name": "Update application status (generic update)",
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/v1/applications/{{id}}",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "v1",
            "applications",
            "{{id}}"
          ]
        },
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"status\": \"SUBMITTED\",\n  \"rejectionReason\": \"Application does not meet requirements\",\n  \"adminNotes\": \"Admin notes here\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        }
      },
      "response": []
    },
    {
      "name": "Delete application (hard delete)",
      "request": {
        "method": "DELETE",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/v1/applications/{{id}}",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "v1",
            "applications",
            "{{id}}"
          ]
        },
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        }
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "BASE_URL",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    },
    {
      "key": "tutorId",
      "value": "",
      "type": "string"
    },
    {
      "key": "studentId",
      "value": "",
      "type": "string"
    },
    {
      "key": "chatId",
      "value": "",
      "type": "string"
    },
    {
      "key": "messageId",
      "value": "",
      "type": "string"
    },
    {
      "key": "sessionId",
      "value": "",
      "type": "string"
    },
    {
      "key": "paymentId",
      "value": "",
      "type": "string"
    },
    {
      "key": "clientSecret",
      "value": "",
      "type": "string"
    },
    {
      "key": "subjectId",
      "value": "",
      "type": "string"
    },
    {
      "key": "applicationId",
      "value": "",
      "type": "string"
    },
    {
      "key": "slotId",
      "value": "",
      "type": "string"
    },
    {
      "key": "trialRequestId",
      "value": "",
      "type": "string"
    },
    {
      "key": "subscriptionId",
      "value": "",
      "type": "string"
    },
    {
      "key": "billingId",
      "value": "",
      "type": "string"
    },
    {
      "key": "earningsId",
      "value": "",
      "type": "string"
    },
    {
      "key": "reviewId",
      "value": "",
      "type": "string"
    },
    {
      "key": "notificationId",
      "value": "",
      "type": "string"
    },
    {
      "key": "TARGET_ID",
      "value": "",
      "type": "string"
    },
    {
      "key": "TEST_EMAIL",
      "value": "test@example.com",
      "type": "string"
    },
    {
      "key": "TEST_PASSWORD",
      "value": "SecurePass123!",
      "type": "string"
    },
    {
      "key": "TEST_NAME",
      "value": "John Doe",
      "type": "string"
    },
    {
      "key": "NEW_PASSWORD",
      "value": "NewSecure123!",
      "type": "string"
    },
    {
      "key": "UPDATED_NAME",
      "value": "Updated Name",
      "type": "string"
    },
    {
      "key": "START_TIME",
      "value": "2025-12-12T21:53:38.071Z",
      "type": "string"
    },
    {
      "key": "END_TIME",
      "value": "2025-12-12T22:53:38.071Z",
      "type": "string"
    },
    {
      "key": "DATE",
      "value": "2025-12-12",
      "type": "string"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-inject Bearer token if available and not already set",
          "const token = pm.collectionVariables.get(\"accessToken\");",
          "",
          "if (token && !pm.request.headers.has(\"Authorization\")) {",
          "  pm.request.headers.add({",
          "    key: \"Authorization\",",
          "    value: \"Bearer \" + token",
          "  });",
          "}",
          "",
          "// Update dynamic timestamps",
          "const now = new Date();",
          "const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);",
          "const dayAfter = new Date(now.getTime() + 25 * 60 * 60 * 1000);",
          "",
          "pm.collectionVariables.set(\"START_TIME\", tomorrow.toISOString());",
          "pm.collectionVariables.set(\"END_TIME\", dayAfter.toISOString());",
          "pm.collectionVariables.set(\"DATE\", tomorrow.toISOString().split(\"T\")[0]);"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Generic response validation",
          "pm.test(\"Status code is 2xx\", function () {",
          "  pm.expect(pm.response.code).to.be.oneOf([200, 201, 204]);",
          "});",
          "",
          "pm.test(\"Response has success field\", function () {",
          "  const response = pm.response.json();",
          "  pm.expect(response).to.have.property(\"success\");",
          "});"
        ]
      }
    }
  ]
}